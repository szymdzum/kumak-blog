---
// CodeBlockLayout enhances code blocks with copy button functionality
---

<script>
  document.addEventListener("DOMContentLoaded", () => {
    // Add copy buttons to all code blocks
    document.querySelectorAll("pre").forEach((pre) => {
      // Skip if it already has a copy button (processed)
      if (pre.querySelector(".copy-button")) return;

      // Get the code element
      const code = pre.querySelector("code");
      if (!code) return;

      // Create wrapper
      const wrapper = document.createElement("div");
      wrapper.className = "code-block";
      pre.parentNode?.insertBefore(wrapper, pre);
      wrapper.appendChild(pre);

      // Extract language class
      let language = "";
      for (const cls of code.classList) {
        if (cls.startsWith("language-")) {
          language = cls.slice(9);
          break;
        }
      }

      // Create header
      const header = document.createElement("div");
      header.className = "code-header";

      // Add language display if available
      if (language) {
        const langSpan = document.createElement("span");
        langSpan.className = "code-language";
        langSpan.textContent = language;
        header.appendChild(langSpan);
      }

      // Add copy button
      const button = document.createElement("button");
      button.className = "copy-button";
      button.setAttribute("aria-label", "Copy code");

      const copyIcon = document.createElement("span");
      copyIcon.className = "copy-icon";
      copyIcon.textContent = "ðŸ“‹";

      const copyText = document.createElement("span");
      copyText.className = "copy-text";
      copyText.textContent = "Copy";

      button.appendChild(copyIcon);
      button.appendChild(copyText);
      header.appendChild(button);

      // Add header to wrapper before pre element
      wrapper.insertBefore(header, pre);

      // Add click event for copying
      button.addEventListener("click", () => {
        const codeText = code.textContent || "";

        navigator.clipboard
          .writeText(codeText)
          .then(() => {
            copyText.textContent = "Copied!";
            setTimeout(() => {
              copyText.textContent = "Copy";
            }, 2000);
          })
          .catch((err) => {
            console.error("Failed to copy code: ", err);
          });
      });
    });
  });
</script>

<slot />

<style is:global>
  /* Styles for enhanced code blocks */
  .code-block {
    margin: 1.5rem 0;
    border-radius: 0.5rem;
    overflow: hidden;
    box-shadow:
      0 4px 6px -1px rgba(0, 0, 0, 0.1),
      0 2px 4px -1px rgba(0, 0, 0, 0.06);
  }

  .code-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0.75rem 1rem;
    background-color: #1a2234;
    color: #e2e8f0;
    border-bottom: 1px solid #2d3748;
  }

  .code-language {
    font-family: "Fira Code", "JetBrains Mono", monospace;
    font-size: 1rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .copy-button {
    display: flex;
    align-items: center;
    background: transparent;
    border: none;
    color: #cbd5e0;
    font-size: 0.75rem;
    padding: 0.25rem 0.5rem;
    cursor: pointer;
    border-radius: 0.25rem;
    transition: background-color 0.2s;
  }

  .copy-button:hover {
    background-color: rgba(255, 255, 255, 0.1);
  }

  .copy-icon {
    margin-right: 0.25rem;
    font-size: 0.875rem;
  }

  .code-block pre {
    margin: 0;
    padding: 1.25rem;
    overflow-x: auto;
    background-color: #1e293b;
    font-size: 0.875rem;
    tab-size: 2;
  }

  .code-block pre code {
    font-family: "Fira Code", "JetBrains Mono", monospace;
    text-shadow: none;
  }
</style>
